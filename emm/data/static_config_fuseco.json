{
    "nubomedia": {
        "connector": {
            "name": "control_server",
            "image": "nubomedia-control-server",
            "port_enable": true,
            "floating_ip_enable": true,
            "user_data": {
                "template":
                    "#!/bin/bash -v \nHOST_NAME=$(cat /etc/hostname) \nsudo sed -i \"s/^\\([0-9]*\\.[0-9]*\\.[0-9]*\\.[0-9]*[ \\t]*localhost\\)/\\1 $HOST_NAME/\" /etc/hosts \nsudo sed -i \"s/^\\([ \\t]*\\\"address\\\"[ \\t]*\\):[ \\t]*\\\"Broker private IP Address\\\"*.*$/\\1: \\\"$BROKER_IP\\\",/\" /etc/kurento/kurento.conf.json \n#sudo sed -i \"s/^\\([ \\t]*\\\"address\\\"[ \\t]*\\):[ \\t]\\\"*[0-9]*\\.[0-9]*\\.[0-9]*\\.[0-9]\\\"*.*$/\\1: \\\"$BROKER_IP\\\",/\" /etc/kurento/kurento.conf.json \nsudo service kurento-control-server restart \n/etc/init.d/kurento-group-call start \n/etc/init.d/kurento-hello-world start \n/etc/init.d/kurento-magic-mirror start \n/etc/init.d/kurento-one2many-call start \n/etc/init.d/kurento-one2one-call start \n/etc/init.d/kurento-one2one-call-advanced start \n/etc/init.d/kurento-pointerdetector start \n/etc/init.d/kurento-chroma start \n/etc/init.d/kurento-crowddetector start \n/etc/init.d/kurento-platedetector start",
                "params":{"$BROKER_IP": {"get_attr": ["broker", "first_address"]}}
            },
            "security_group": {
                "name": "security_group_controller",
                "rules": [
                    {
                    "name": "rule_icmp",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "icmp"
                    },
                    {
                    "name": "rule_tcp_22",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "tcp",
                    "port_range_min": "22",
                    "port_range_max": "22"
                    },
                    {
                    "name": "rule_tcp_8887_8888",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "tcp",
                    "port_range_min": "8887",
                    "port_range_max": "8888"
                    },
                    {
                    "name": "rule_tcp_8080-8090",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "tcp",
                    "port_range_min": "8080",
                    "port_range_max": "9000"
                    }
                ]
            }
        },
        "broker": {
            "name": "broker",
            "image": "nubomedia-broker",
            "port_enable": true,
            "floating_ip_enable": true,
            "user_data":{
                "template":
                    "#!/bin/bash -v \nHOST_NAME=$(cat /etc/hostname) \nsudo sed -i \"s/^\\([0-9]*\\.[0-9]*\\.[0-9]*\\.[0-9]*[ \\t]*localhost\\)/\\1 $HOST_NAME/\" /etc/hosts",
                "params": {
                    "\"\"":"\"\""
                }
            },
            "security_group": {
                "name": "security_group_broker",
                "rules": [
                    {
                    "name": "rule_icmp",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "icmp"
                    },
                    {
                    "name": "rule_tcp_22",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "tcp",
                    "port_range_min": "22",
                    "port_range_max": "22"
                    },
                    {
                    "name": "rule_tcp_5672",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "tcp",
                    "port_range_min": "5672",
                    "port_range_max": "5672"
                    }
                ]
            }
        },
        "media_server_group": {
            "group_name": "media_server_group",
            "instance_name": "Media Server",
            "image": "nubomedia-media-server",
            "floating_ip_enable": true,
            "policies": {
                "alarm":{
                    "evaluation_periods": 1,
                    "repeat_actions": true
                }
            },
            "user_data": {
                "template": 
                    "#!/bin/bash -v \nHOST_NAME=$(cat /etc/hostname) \nsudo sed -i \"s/^\\([0-9]*\\.[0-9]*\\.[0-9]*\\.[0-9]*[ \\t]*localhost\\)/\\1 $HOST_NAME/\" /etc/hosts \ncp /etc/kurento/kurento-broker.conf.json /etc/kurento/kurento.conf.json \nsudo sed -i \"s/^\\([ \\t]*\\\"address\\\"[ \\t]*\\):[ \\t]*.*[0-9]*\\.[0-9]*\\.[0-9]*\\.[0-9]\\\"*.*$/\\1: \\\"$BROKER_IP\\\",/\" /etc/kurento/kurento.conf.json \nsudo service kurento-media-server restart",
                "params": {
                    "$BROKER_IP": {"get_attr": ["broker", "first_address"] }
                }
            },
            "security_group": {
                "name": "security_group_media_server",
                "rules": [
                    {
                    "name": "rule_icmp",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "icmp"
                    },
                    {
                    "name": "rule_tcp_22",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "tcp",
                    "port_range_min": "22",
                    "port_range_max": "22"
                    },
                    {
                    "name": "rule_tcp_8888",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "tcp",
                    "port_range_min": "8888",
                    "port_range_max": "8888"
                    },
                    {
                    "name": "rule_udp",
                    "remote_ip_prefix": "0.0.0.0/0",
                    "protocol": "udp",
                    "port_range_min": "1024",
                    "port_range_max": "65535"
                    }
                ]
            }
        }
    }
}
